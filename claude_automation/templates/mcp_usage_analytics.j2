## 🔌 MCP Server Status

**Last Updated**: {{ timestamp }}
**Analysis Period**: {{ config.analysis_period_days }} days

### Configured Servers ({{ config.total_configured_servers }})

{% if config.configured_servers %}
{% for server in config.configured_servers %}
**{{ loop.index }}. {{ server.name }}** {{ server.status.value|status_icon }} {{ server.status.value|upper }}
   - **Type**: {{ server.type.value }}
   - **Command**: `{{ server.command }}{% if server.args %} {{ server.args|join(' ') }}{% endif %}`
   - **Location**: {{ server.config_location }}
{% if server.description %}   - **Description**: {{ server.description }}
{% endif %}
{% endfor %}
{% else %}
No MCP servers configured.
{% endif %}

### Connection Health

{% if config.connected_servers %}
- ✅ **Connected**: {{ config.connected_servers|length }} server(s)
{% for server in config.connected_servers %}  - {{ server.name }}
{% endfor %}
{% else %}
- ⚠️ No servers are currently connected
{% endif %}

{% if config.unused_servers %}
- ℹ️  **Configured but not analyzed**: {{ config.unused_servers|length }} server(s)
{% for server in config.unused_servers %}  - {{ server.name }} (usage tracking not yet implemented)
{% endfor %}
{% endif %}

### Usage Analytics

{% if config.tool_usage %}
**Total MCP invocations**: {{ config.total_invocations }}
**Total tokens consumed**: {{ "{:,}".format(config.tool_usage|sum(attribute='total_tokens')|int) }}
**Estimated total cost**: ${{ "%.4f"|format(config.tool_usage|sum(attribute='estimated_cost_usd')) }}

{% for usage in config.tool_usage|sort(attribute='total_tokens', reverse=True) %}
#### {{ usage.server_name }}.{{ usage.tool_name }} ({{ usage.scope }} scope)

**Usage Metrics:**
- Invocations: {{ usage.invocation_count }}
- Success rate: {{ "%.1f"|format(usage.success_rate) }}%
{% if usage.last_used %}- Last used: {{ usage.last_used.strftime('%Y-%m-%d %H:%M') }}
{% endif %}

**Token Consumption:**
- Total tokens: {{ "{:,}".format(usage.total_tokens) }} (Input: {{ "{:,}".format(usage.input_tokens) }}, Output: {{ "{:,}".format(usage.output_tokens) }})
- Cache tokens: {{ "{:,}".format(usage.cache_read_tokens) }} reads, {{ "{:,}".format(usage.cache_creation_tokens) }} writes
- Avg tokens/invocation: {{ "%.0f"|format(usage.avg_tokens_per_invocation) }}

**Cost Analysis:**
- Estimated cost: ${{ "%.4f"|format(usage.estimated_cost_usd) }}
- ROI score: {{ "%.2f"|format(usage.roi_score) }} invocations per 1K tokens
{% if usage.roi_score > 10.0 %}- 💚 **High efficiency** - Excellent value for tokens consumed
{% elif usage.roi_score < 1.0 %}- ⚠️  **Low efficiency** - Consider reviewing usage patterns
{% endif %}

{% endfor %}
{% else %}
No MCP usage data available for the analysis period.

**Note**: MCP usage tracking requires Claude Code session logs in `~/.claude/projects/`.
{% endif %}

{% if config.recommendations %}
### Recommendations

{% for rec in config.recommendations|sort(attribute='priority') %}
**{{ rec.priority|priority_label }}**: {{ rec.server_name }}
   - **Issue**: {{ rec.reason }}
   - **Action**: {{ rec.action }}

{% endfor %}
{% else %}
No recommendations at this time. All configured servers appear to be working correctly.
{% endif %}

---
*MCP analytics auto-generated by claude-nixos-automation*
*Next update: On next rebuild or weekly*